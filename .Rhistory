ggplot(phyla, aes(Firmicutes*100, mean_abund, colour = Treatment)) +
geom_point(size = 3, shape = 16, alpha = 1) +
geom_smooth(aes(Firmicutes*100, mean_abund),
method = "lm", inherit.aes = F, alpha = 0.1) +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 2, label = "R^2 == 0.39"),
parse = TRUE, size = 2,  check_overlap = TRUE) +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 5, label = "p = 0.005"),
size = 2, check_overlap = TRUE) +
scale_colour_manual(values = c("#3B528BFF", "#21908CFF", "#5DC863FF", "#FDE725FF")) +
labs(x = "Firmicutes % abundance",
y = "Mean spore gene DESeq2 abundance") +
theme_classic()
ggplot(phyla, aes(Firmicutes*100, mean_abund, colour = Treatment)) +
geom_point(size = 3, shape = 16, alpha = 1) +
geom_smooth(aes(Firmicutes*100, mean_abund),
method = "lm", inherit.aes = F, alpha = 0.1) +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 2, label = "R^2 == 0.39"),
parse = TRUE, size = 4,  check_overlap = TRUE) +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 5, label = "p = 0.005"),
size = 4, check_overlap = TRUE) +
scale_colour_manual(values = c("#3B528BFF", "#21908CFF", "#5DC863FF", "#FDE725FF")) +
labs(x = "Firmicutes % abundance",
y = "Mean spore gene DESeq2 abundance") +
theme_classic()
ggplot(phyla, aes(Firmicutes*100, mean_abund, colour = Treatment)) +
geom_point(size = 3, shape = 16, alpha = 1) +
geom_smooth(aes(Firmicutes*100, mean_abund),
method = "lm", inherit.aes = F, alpha = 0.1) +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 2, label = "R^2 == 0.39"),
parse = TRUE, size = 4,  check_overlap = TRUE) +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 5, label = "p = 0.005"),
size = 4, check_overlap = TRUE) +
scale_colour_manual(values = c("#3B528BFF", "#21908CFF", "#5DC863FF", "#FDE725FF")) +
labs(x = "Firmicutes % abundance",
y = "Mean spore gene DESeq2 abundance") +
theme_bw() +
theme(axis.title = element_text(size = 12),
axis.text = element_text(size = 10))
ggplot(phyla, aes(Firmicutes*100, mean_abund, colour = Treatment)) +
geom_point(size = 3, shape = 16, alpha = 1) +
geom_smooth(aes(Firmicutes*100, mean_abund),
method = "lm", inherit.aes = F, alpha = 0.1) +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 2, label = "R^2 == 0.39"),
parse = TRUE, size = 4,  check_overlap = TRUE, show.legend = F) +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 5, label = "p = 0.005"),
size = 4, check_overlap = TRUE, show.legend = F) +
scale_colour_manual(values = c("#3B528BFF", "#21908CFF", "#5DC863FF", "#FDE725FF")) +
labs(x = "Firmicutes % abundance",
y = "Mean spore gene DESeq2 abundance") +
theme_bw() +
theme(axis.title = element_text(size = 12),
axis.text = element_text(size = 10))
ggplot(phyla, aes(Firmicutes*100, mean_abund, colour = Treatment)) +
geom_point(size = 3, shape = 16, alpha = 1) +
geom_smooth(aes(Firmicutes*100, mean_abund),
method = "lm", inherit.aes = F, alpha = 0.1) +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 2, label = "R^2 == 0.39"),
parse = TRUE, size = 4,  check_overlap = TRUE, show.legend = F, color = "black") +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 5, label = "p = 0.005"),
size = 4, check_overlap = TRUE, show.legend = F, color = "black") +
scale_colour_manual(values = c("#3B528BFF", "#21908CFF", "#5DC863FF", "#FDE725FF")) +
labs(x = "Firmicutes % abundance",
y = "Mean spore gene DESeq2 abundance") +
theme_bw() +
theme(axis.title = element_text(size = 12),
axis.text = element_text(size = 10))
png("InitialFigs/SporeGenes_Firmicutes.png", width = 7, height = 5, res = 300, units = "in")
ggplot(phyla, aes(Firmicutes*100, mean_abund, colour = Treatment)) +
geom_point(size = 3, shape = 16, alpha = 1) +
geom_smooth(aes(Firmicutes*100, mean_abund),
method = "lm", inherit.aes = F, alpha = 0.1) +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 2, label = "R^2 == 0.39"),
parse = TRUE, size = 4,  check_overlap = TRUE, show.legend = F, color = "black") +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 5, label = "p = 0.005"),
size = 4, check_overlap = TRUE, show.legend = F, color = "black") +
scale_colour_manual(values = c("#3B528BFF", "#21908CFF", "#5DC863FF", "#FDE725FF")) +
labs(x = "Firmicutes % abundance",
y = "Mean spore gene DESeq2 abundance") +
theme_bw() +
theme(axis.title = element_text(size = 12),
axis.text = element_text(size = 10))
dev.off()
png("InitialFigs/SporeGenes_Firmicutes.png", width = 7, height = 5, res = 300, units = "in")
ggplot(phyla, aes(Firmicutes*100, mean_abund, colour = Treatment)) +
geom_point(size = 3, shape = 16, alpha = 1) +
geom_smooth(aes(Firmicutes*100, mean_abund),
method = "lm", inherit.aes = F, alpha = 0.1) +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 2, label = "R^2 == 0.39"),
parse = TRUE, size = 4,  check_overlap = TRUE, show.legend = F, color = "black") +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 5, label = "p = 0.005"),
size = 4, check_overlap = TRUE, show.legend = F, color = "black") +
scale_colour_manual(values = c("#3B528BFF", "#21908CFF", "#5DC863FF", "#FDE725FF")) +
labs(x = "Firmicutes % abundance (mTags)",
y = "Mean spore gene DESeq2 abundance") +
theme_bw() +
theme(axis.title = element_text(size = 12),
axis.text = element_text(size = 10))
dev.off()
# Now check iTags too
nc <- readRDS("data/nc.rds")
nc_cn <- read_excel("~/Documents/GitHub/EastCoast/data/Copy of CHN data.xls", sheet = 2) %>%
slice(12:91) %>%
dplyr::select(Name, `%N`, `%C`, `C:N`) %>%
mutate(Name = gsub("bottom", "bot", Name)) %>%
separate(Name, into = c("ID", "Depth"), sep = " ", remove = F) %>%
mutate(Treatment = substr(ID, start = 1, stop = 1),
Hydro = substr(ID, start = 2, stop = 2),
Replicate = substr(ID, start = 3, stop = 3)) %>%
filter(Hydro == "F") %>%
mutate(Treatment = recode_factor(Treatment,
"A" = "Control",
"B" = "ASW",
"C" = "ASW_noS",
"D" = "SO4")) %>%
mutate(Treatment = factor(Treatment,
levels = c("ASW", "ASW_noS", "Control", "SO4"))) %>%
arrange(desc(Depth), Treatment) %>%
filter(Name %notin% c("BF1 top", "BF2 top", "AF1 top", "DF2 top", "BF2 bot", "CF1 bot", "AF2 bot"))
library(readxl)
nc_cn <- read_excel("~/Documents/GitHub/EastCoast/data/Copy of CHN data.xls", sheet = 2) %>%
slice(12:91) %>%
dplyr::select(Name, `%N`, `%C`, `C:N`) %>%
mutate(Name = gsub("bottom", "bot", Name)) %>%
separate(Name, into = c("ID", "Depth"), sep = " ", remove = F) %>%
mutate(Treatment = substr(ID, start = 1, stop = 1),
Hydro = substr(ID, start = 2, stop = 2),
Replicate = substr(ID, start = 3, stop = 3)) %>%
filter(Hydro == "F") %>%
mutate(Treatment = recode_factor(Treatment,
"A" = "Control",
"B" = "ASW",
"C" = "ASW_noS",
"D" = "SO4")) %>%
mutate(Treatment = factor(Treatment,
levels = c("ASW", "ASW_noS", "Control", "SO4"))) %>%
arrange(desc(Depth), Treatment) %>%
filter(Name %notin% c("BF1 top", "BF2 top", "AF1 top", "DF2 top", "BF2 bot", "CF1 bot", "AF2 bot"))
nc_cn <- read_excel("~/Documents/GitHub/EastCoast/data/Copy of CHN data.xls", sheet = 2)
View(nc_cn)
View(nc_cn)
View(nc_cn)
nc_cn <- read_excel("~/Documents/GitHub/EastCoast/data/Copy of CHN data.xls", sheet = 2) %>%
#slice(12:91) %>%
slice_tail(n = 79)
View(nc_cn)
nc_cn <- read_excel("~/Documents/GitHub/EastCoast/data/Copy of CHN data.xls", sheet = 2) %>%
#slice(12:91) %>%
slice_tail(n = 80)
View(nc_cn)
nc_cn <- read_excel("~/Documents/GitHub/EastCoast/data/Copy of CHN data.xls", sheet = 2) %>%
#slice(12:91) %>%
slice_tail(n = 80) %>%
dplyr::select(Name, `%N`, `%C`, `C:N`) %>%
mutate(Name = gsub("bottom", "bot", Name)) %>%
separate(Name, into = c("ID", "Depth"), sep = " ", remove = F) %>%
mutate(Treatment = substr(ID, start = 1, stop = 1),
Hydro = substr(ID, start = 2, stop = 2),
Replicate = substr(ID, start = 3, stop = 3)) %>%
filter(Hydro == "F") %>%
mutate(Treatment = recode_factor(Treatment,
"A" = "Control",
"B" = "ASW",
"C" = "ASW_noS",
"D" = "SO4")) %>%
mutate(Treatment = factor(Treatment,
levels = c("ASW", "ASW_noS", "Control", "SO4"))) %>%
arrange(desc(Depth), Treatment) %>%
filter(Name %notin% c("BF1 top", "BF2 top", "AF1 top", "DF2 top", "BF2 bot", "CF1 bot", "AF2 bot"))
rownames(nc$map_loaded)[11:43]
nc$map_loaded$sed_per_C[11:43] <- nc_cn$`%C`
nc$map_loaded$sed_per_N[11:43] <- nc_cn$`%N`
nc$map_loaded$sed_CN[11:43] <- nc_cn$`C:N`
for (i in 1:nrow(nc$map_loaded)) {
if (nc$map_loaded$sampleID[i] == "TL_inc_d1_SO4_5B") {
nc$map_loaded$Depth[i] <- "10-15 cm"
nc$map_loaded$sampleID_clean[i] <- "+SO4_5B_D2"
}
}
for (i in 1:nrow(nc$map_loaded)) {
if (nc$map_loaded$sampleID[i] == "TL_inc_d2_SO4_5B") {
nc$map_loaded$Depth[i] <- "0-5 cm"
nc$map_loaded$sampleID_clean[i] <- "+SO4_5B_D1"
}
}
new_dat <- read_excel("data/Soil pH-Jessie.xls", sheet = 3, na = "NA")
nc$map_loaded[25, 10:24] <- new_dat[1, 2:16]
nc$map_loaded[26, 10:24] <- new_dat[2, 2:16]
nc$map_loaded[42, 10:24] <- new_dat[3, 2:16]
nc$map_loaded[43, 10:24] <- new_dat[4, 2:16]
nc$map_loaded$SO4 <- recode_factor(nc$map_loaded$Treatment,
"+SO4" = "Sulfate",
"+ASW" = "SaltSulfate")
nc$map_loaded$SO4 <- grepl(x = nc$map_loaded$SO4, pattern = "Sulfate")
nc$map_loaded$ASW <- recode_factor(nc$map_loaded$Treatment,
"+ASW-SO4" = "Salt",
"+ASW" = "SaltSulfate")
nc$map_loaded$ASW <- grepl(x = nc$map_loaded$ASW, pattern = "Salt")
phyla <- summarize_taxonomy(nc, 2, relative = T, report_higher_tax = F)
View(phyla)
View(nc$map_loaded)
# Get just depth 2
nc <- filter_data(nc, filter_cat = "Depth", keep_vals = "10-15 cm")
View(nc$map_loaded)
nc <- filter_data(nc, filter_cat = "Treatment", filter_vals = "Field")
View(nc$map_loaded)
nc <- filter_data(nc, filter_cat = "SampleID", filter_vals = "TL_inc_d2_ASW_noS_3")
nc <- filter_data(nc, filter_cat = "sampleID", filter_vals = "TL_inc_d2_ASW_noS_3")
View(nc$map_loaded)
rownames(nc$map_loaded)
View(pf_DESeq_lab_t_sf)
View(meta_IMG_lab)
phyla <- summarize_taxonomy(nc, 2, relative = T, report_higher_tax = F) %>%
select(-Field_1, -Field_2, -Field_3, -Field_4, -Field_5) %>%
select(TL_inc_d2_DI_ctrl_1, TL_inc_d2_DI_ctrl_3, TL_inc_d2_DI_ctrl_4, TL_inc_d2_DI_ctrl_5,
TL_inc_d2_SO4_2, TL_inc_d2_SO4_3, TL_inc_d2_SO4_4, TL_inc_d2_SO4_5A,
`TL_inc_d2_ASW_noS_2`, `TL_inc_d2_ASW_noS_4`, `TL_inc_d2_ASW_noS_5`,
TL_inc_d2_ASW_1, TL_inc_d2_ASW_3, TL_inc_d2_ASW_4, TL_inc_d2_ASW_5) %>%
t() %>%
as.data.frame() %>%
select(Firmicutes) %>%
mutate(mean_abund = sf_mean$mean_abund) %>%
mutate("Treatment" = c(rep("Control", 4),
rep("SO4", 4),
rep("ASW-S", 3),
rep("ASW", 4))) %>%
mutate(Treatment = factor(Treatment,
levels = c("Control", "SO4", "ASW-S", "ASW")))
phyla <- summarize_taxonomy(nc, 2, relative = T, report_higher_tax = F) %>%
select(TL_inc_d2_DI_ctrl_1, TL_inc_d2_DI_ctrl_3, TL_inc_d2_DI_ctrl_4, TL_inc_d2_DI_ctrl_5,
TL_inc_d2_SO4_2, TL_inc_d2_SO4_3, TL_inc_d2_SO4_4, TL_inc_d2_SO4_5A,
`TL_inc_d2_ASW_noS_2`, `TL_inc_d2_ASW_noS_4`, `TL_inc_d2_ASW_noS_5`,
TL_inc_d2_ASW_1, TL_inc_d2_ASW_3, TL_inc_d2_ASW_4, TL_inc_d2_ASW_5) %>%
t() %>%
as.data.frame() %>%
select(Firmicutes) %>%
mutate(mean_abund = sf_mean$mean_abund) %>%
mutate("Treatment" = c(rep("Control", 4),
rep("SO4", 4),
rep("ASW-S", 3),
rep("ASW", 4))) %>%
mutate(Treatment = factor(Treatment,
levels = c("Control", "SO4", "ASW-S", "ASW")))
View(sf_mean)
View(sf_mean)
sf_mean_iTag <- sf_mean %>%
t() %>%
as.data.frame() %>%
select(Control_1, Control_3, Control_4, Control_5,
SO4_2, SO4_3, SO4_4, SO4_5,
`ASW-S_2`, `ASW-S_4`, `ASW-S_5`,
ASW_1, ASW_3, ASW_4, ASW_5) %>%
t() %>%
as.data.frame()
View(sf_mean_iTag)
phyla <- summarize_taxonomy(nc, 2, relative = T, report_higher_tax = F) %>%
select(TL_inc_d2_DI_ctrl_1, TL_inc_d2_DI_ctrl_3, TL_inc_d2_DI_ctrl_4, TL_inc_d2_DI_ctrl_5,
TL_inc_d2_SO4_2, TL_inc_d2_SO4_3, TL_inc_d2_SO4_4, TL_inc_d2_SO4_5A,
`TL_inc_d2_ASW_noS_2`, `TL_inc_d2_ASW_noS_4`, `TL_inc_d2_ASW_noS_5`,
TL_inc_d2_ASW_1, TL_inc_d2_ASW_3, TL_inc_d2_ASW_4, TL_inc_d2_ASW_5) %>%
t() %>%
as.data.frame() %>%
select(Firmicutes) %>%
mutate(mean_abund = sf_mean$mean_abund) %>%
mutate("Treatment" = c(rep("Control", 4),
rep("SO4", 4),
rep("ASW-S", 3),
rep("ASW", 4))) %>%
mutate(Treatment = factor(Treatment,
levels = c("Control", "SO4", "ASW-S", "ASW")))
phyla <- summarize_taxonomy(nc, 2, relative = T, report_higher_tax = F) %>%
select(TL_inc_d2_DI_ctrl_1, TL_inc_d2_DI_ctrl_3, TL_inc_d2_DI_ctrl_4, TL_inc_d2_DI_ctrl_5,
TL_inc_d2_SO4_2, TL_inc_d2_SO4_3, TL_inc_d2_SO4_4, TL_inc_d2_SO4_5A,
`TL_inc_d2_ASW_noS_2`, `TL_inc_d2_ASW_noS_4`, `TL_inc_d2_ASW_noS_5`,
TL_inc_d2_ASW_1, TL_inc_d2_ASW_3, TL_inc_d2_ASW_4, TL_inc_d2_ASW_5) %>%
t() %>%
as.data.frame() %>%
select(Firmicutes) %>%
mutate(mean_abund = sf_mean_iTag$mean_abund) %>%
mutate("Treatment" = c(rep("Control", 4),
rep("SO4", 4),
rep("ASW-S", 3),
rep("ASW", 4))) %>%
mutate(Treatment = factor(Treatment,
levels = c("Control", "SO4", "ASW-S", "ASW")))
m <- lm(mean_abund ~ Firmicutes, data = phyla)
summary(m)
ggplot(phyla, aes(Firmicutes*100, mean_abund, colour = Treatment)) +
geom_point(size = 3, shape = 16, alpha = 1) +
geom_smooth(aes(Firmicutes*100, mean_abund),
method = "lm", inherit.aes = F, alpha = 0.1) +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 2, label = "R^2 == 0.37"),
parse = TRUE, size = 4,  check_overlap = TRUE, show.legend = F, color = "black") +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 5, label = "p = 0.017"),
size = 4, check_overlap = TRUE, show.legend = F, color = "black") +
scale_colour_manual(values = c("#3B528BFF", "#21908CFF", "#5DC863FF", "#FDE725FF")) +
labs(x = "Firmicutes % abundance (iTags)",
y = "Mean spore gene DESeq2 abundance") +
theme_bw() +
theme(axis.title = element_text(size = 12),
axis.text = element_text(size = 10))
#### _mTags ####
# Average the DESeq abundance of the 68 spore genes by sample
sf_mean <- colMeans(pf_DESeq_lab_t_sf) %>%
as.data.frame() %>%
rename("." = "mean_abund")
# Get mtags Firmicutes
d <- readRDS("data/input_filt_rare_mTAGs.rds")
phyla <- summarize_taxonomy(d, 2, relative = T, report_higher_tax = F) %>%
select(-Field_1, -Field_2, -Field_3, -Field_4, -Field_5) %>%
select(Control_1, Control_2, Control_3, Control_4, Control_5,
SO4_1, SO4_2, SO4_3, SO4_4, SO4_5,
`ASW_S_2`, `ASW_S_4`, `ASW_S_5`,
ASW_1, ASW_2, ASW_3, ASW_4, ASW_5) %>%
t() %>%
as.data.frame() %>%
select(Firmicutes) %>%
mutate(mean_abund = sf_mean$mean_abund) %>%
mutate("Treatment" = c(rep("Control", 5),
rep("SO4", 5),
rep("ASW-S", 3),
rep("ASW", 5))) %>%
mutate(Treatment = factor(Treatment,
levels = c("Control", "SO4", "ASW-S", "ASW")))
m <- lm(mean_abund ~ Firmicutes, data = phyla)
summary(m)
ggplot(phyla, aes(Firmicutes*100, mean_abund, colour = Treatment)) +
geom_point(size = 3, shape = 16, alpha = 1) +
geom_smooth(aes(Firmicutes*100, mean_abund),
method = "lm", inherit.aes = F, alpha = 0.1) +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 2, label = "R^2 == 0.39"),
parse = TRUE, size = 4,  check_overlap = TRUE, show.legend = F, color = "black") +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 5, label = "p = 0.005"),
size = 4, check_overlap = TRUE, show.legend = F, color = "black") +
scale_colour_manual(values = c("#3B528BFF", "#21908CFF", "#5DC863FF", "#FDE725FF")) +
labs(x = "Firmicutes % abundance (mTags)",
y = "Mean spore gene DESeq2 abundance") +
theme_bw() +
theme(axis.title = element_text(size = 12),
axis.text = element_text(size = 10))
View(phyla)
View(phyla)
# mTag vs iTag Firmicutes
phyla_15 <- phyla %>%
t() %>%
as.data.frame() %>%
select(Control_1, Control_3, Control_4, Control_5,
SO4_2, SO4_3, SO4_4, SO4_5,
`ASW_S_2`, `ASW_S_4`, `ASW_S_5`,
ASW_1, ASW_3, ASW_4, ASW_5) %>%
t() %>%
as.data.frame()
#### _iTags ####
# Now check iTags too
nc <- readRDS("data/nc.rds")
nc_cn <- read_excel("~/Documents/GitHub/EastCoast/data/Copy of CHN data.xls", sheet = 2) %>%
#slice(12:91) %>%
slice_tail(n = 80) %>%
dplyr::select(Name, `%N`, `%C`, `C:N`) %>%
mutate(Name = gsub("bottom", "bot", Name)) %>%
separate(Name, into = c("ID", "Depth"), sep = " ", remove = F) %>%
mutate(Treatment = substr(ID, start = 1, stop = 1),
Hydro = substr(ID, start = 2, stop = 2),
Replicate = substr(ID, start = 3, stop = 3)) %>%
filter(Hydro == "F") %>%
mutate(Treatment = recode_factor(Treatment,
"A" = "Control",
"B" = "ASW",
"C" = "ASW_noS",
"D" = "SO4")) %>%
mutate(Treatment = factor(Treatment,
levels = c("ASW", "ASW_noS", "Control", "SO4"))) %>%
arrange(desc(Depth), Treatment) %>%
filter(Name %notin% c("BF1 top", "BF2 top", "AF1 top", "DF2 top", "BF2 bot", "CF1 bot", "AF2 bot"))
rownames(nc$map_loaded)[11:43]
nc$map_loaded$sed_per_C[11:43] <- nc_cn$`%C`
nc$map_loaded$sed_per_N[11:43] <- nc_cn$`%N`
nc$map_loaded$sed_CN[11:43] <- nc_cn$`C:N`
for (i in 1:nrow(nc$map_loaded)) {
if (nc$map_loaded$sampleID[i] == "TL_inc_d1_SO4_5B") {
nc$map_loaded$Depth[i] <- "10-15 cm"
nc$map_loaded$sampleID_clean[i] <- "+SO4_5B_D2"
}
}
for (i in 1:nrow(nc$map_loaded)) {
if (nc$map_loaded$sampleID[i] == "TL_inc_d2_SO4_5B") {
nc$map_loaded$Depth[i] <- "0-5 cm"
nc$map_loaded$sampleID_clean[i] <- "+SO4_5B_D1"
}
}
new_dat <- read_excel("data/Soil pH-Jessie.xls", sheet = 3, na = "NA")
nc$map_loaded[25, 10:24] <- new_dat[1, 2:16]
nc$map_loaded[26, 10:24] <- new_dat[2, 2:16]
nc$map_loaded[42, 10:24] <- new_dat[3, 2:16]
nc$map_loaded[43, 10:24] <- new_dat[4, 2:16]
nc$map_loaded$SO4 <- recode_factor(nc$map_loaded$Treatment,
"+SO4" = "Sulfate",
"+ASW" = "SaltSulfate")
nc$map_loaded$SO4 <- grepl(x = nc$map_loaded$SO4, pattern = "Sulfate")
nc$map_loaded$ASW <- recode_factor(nc$map_loaded$Treatment,
"+ASW-SO4" = "Salt",
"+ASW" = "SaltSulfate")
nc$map_loaded$ASW <- grepl(x = nc$map_loaded$ASW, pattern = "Salt")
# Get just depth 2, lab, match MG
# Note: missing Control_2, ASW_2, SO4_1
# Plus SO4 5B can't match.
nc <- filter_data(nc, filter_cat = "Depth", keep_vals = "10-15 cm")
nc <- filter_data(nc, filter_cat = "Treatment", filter_vals = "Field")
nc <- filter_data(nc, filter_cat = "sampleID", filter_vals = "TL_inc_d2_ASW_noS_3")
sf_mean_iTag <- sf_mean %>%
t() %>%
as.data.frame() %>%
select(Control_1, Control_3, Control_4, Control_5,
SO4_2, SO4_3, SO4_4, SO4_5,
`ASW-S_2`, `ASW-S_4`, `ASW-S_5`,
ASW_1, ASW_3, ASW_4, ASW_5) %>%
t() %>%
as.data.frame()
phyla_iTag <- summarize_taxonomy(nc, 2, relative = T, report_higher_tax = F) %>%
select(TL_inc_d2_DI_ctrl_1, TL_inc_d2_DI_ctrl_3, TL_inc_d2_DI_ctrl_4, TL_inc_d2_DI_ctrl_5,
TL_inc_d2_SO4_2, TL_inc_d2_SO4_3, TL_inc_d2_SO4_4, TL_inc_d2_SO4_5A,
`TL_inc_d2_ASW_noS_2`, `TL_inc_d2_ASW_noS_4`, `TL_inc_d2_ASW_noS_5`,
TL_inc_d2_ASW_1, TL_inc_d2_ASW_3, TL_inc_d2_ASW_4, TL_inc_d2_ASW_5) %>%
t() %>%
as.data.frame() %>%
select(Firmicutes) %>%
mutate(mean_abund = sf_mean_iTag$mean_abund) %>%
mutate("Treatment" = c(rep("Control", 4),
rep("SO4", 4),
rep("ASW-S", 3),
rep("ASW", 4))) %>%
mutate(Treatment = factor(Treatment,
levels = c("Control", "SO4", "ASW-S", "ASW")))
m <- lm(mean_abund ~ Firmicutes, data = phyla_iTag)
summary(m)
ggplot(phyla_iTag, aes(Firmicutes*100, mean_abund, colour = Treatment)) +
geom_point(size = 3, shape = 16, alpha = 1) +
geom_smooth(aes(Firmicutes*100, mean_abund),
method = "lm", inherit.aes = F, alpha = 0.1) +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 2, label = "R^2 == 0.37"),
parse = TRUE, size = 4,  check_overlap = TRUE, show.legend = F, color = "black") +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 5, label = "p = 0.017"),
size = 4, check_overlap = TRUE, show.legend = F, color = "black") +
scale_colour_manual(values = c("#3B528BFF", "#21908CFF", "#5DC863FF", "#FDE725FF")) +
labs(x = "Firmicutes % abundance (iTags)",
y = "Mean spore gene DESeq2 abundance") +
theme_bw() +
theme(axis.title = element_text(size = 12),
axis.text = element_text(size = 10))
m <- lm(Firmicutes_mTag ~ Firmicutes, data = phyla_iTag)
phyla_iTag$Firmicutes_mTag <- phyla_15$Firmicutes
m <- lm(Firmicutes_mTag ~ Firmicutes, data = phyla_iTag)
summary(m)
ggplot(phyla_iTag, aes(Firmicutes*100, Firmicutes_mTag*100, colour = Treatment)) +
geom_point(size = 3, shape = 16, alpha = 1) +
geom_smooth(aes(Firmicutes*100, mean_abund),
method = "lm", inherit.aes = F, alpha = 0.1) +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 2, label = "R^2 == 0.95"),
parse = TRUE, size = 4,  check_overlap = TRUE, show.legend = F, color = "black") +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 5, label = "p < 0.001"),
size = 4, check_overlap = TRUE, show.legend = F, color = "black") +
scale_colour_manual(values = c("#3B528BFF", "#21908CFF", "#5DC863FF", "#FDE725FF")) +
labs(x = "Firmicutes % abundance (iTags)",
y = "Firmicutes % abundance (mTags") +
theme_bw() +
theme(axis.title = element_text(size = 12),
axis.text = element_text(size = 10))
phyla_iTag$Firmicutes_mTag <- as.numeric(phyla_15$Firmicutes)
m <- lm(Firmicutes_mTag ~ Firmicutes, data = phyla_iTag)
summary(m)
ggplot(phyla_iTag, aes(Firmicutes*100, Firmicutes_mTag*100, colour = Treatment)) +
geom_point(size = 3, shape = 16, alpha = 1) +
geom_smooth(aes(Firmicutes*100, mean_abund),
method = "lm", inherit.aes = F, alpha = 0.1) +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 2, label = "R^2 == 0.95"),
parse = TRUE, size = 4,  check_overlap = TRUE, show.legend = F, color = "black") +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 5, label = "p < 0.001"),
size = 4, check_overlap = TRUE, show.legend = F, color = "black") +
scale_colour_manual(values = c("#3B528BFF", "#21908CFF", "#5DC863FF", "#FDE725FF")) +
labs(x = "Firmicutes % abundance (iTags)",
y = "Firmicutes % abundance (mTags") +
theme_bw() +
theme(axis.title = element_text(size = 12),
axis.text = element_text(size = 10))
ggplot(phyla_iTag, aes(Firmicutes*100, Firmicutes_mTag*100, colour = Treatment)) +
geom_point(size = 3, shape = 16, alpha = 1) +
geom_smooth(aes(Firmicutes*100, Firmicutes_mTag*100),
method = "lm", inherit.aes = F, alpha = 0.1) +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 2, label = "R^2 == 0.95"),
parse = TRUE, size = 4,  check_overlap = TRUE, show.legend = F, color = "black") +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 5, label = "p < 0.001"),
size = 4, check_overlap = TRUE, show.legend = F, color = "black") +
scale_colour_manual(values = c("#3B528BFF", "#21908CFF", "#5DC863FF", "#FDE725FF")) +
labs(x = "Firmicutes % abundance (iTags)",
y = "Firmicutes % abundance (mTags") +
theme_bw() +
theme(axis.title = element_text(size = 12),
axis.text = element_text(size = 10))
ggplot(phyla_iTag, aes(Firmicutes*100, Firmicutes_mTag*100, colour = Treatment)) +
geom_point(size = 3, shape = 16, alpha = 1) +
geom_abline(intercept = 0, slope = 1, linetype = "dashed") +
geom_smooth(aes(Firmicutes*100, Firmicutes_mTag*100),
method = "lm", inherit.aes = F, alpha = 0.1) +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 2, label = "R^2 == 0.95"),
parse = TRUE, size = 4,  check_overlap = TRUE, show.legend = F, color = "black") +
geom_text(aes(x = 0, y = Inf, hjust = -0.1, vjust = 5, label = "p < 0.001"),
size = 4, check_overlap = TRUE, show.legend = F, color = "black") +
scale_colour_manual(values = c("#3B528BFF", "#21908CFF", "#5DC863FF", "#FDE725FF")) +
labs(x = "Firmicutes % abundance (iTags)",
y = "Firmicutes % abundance (mTags") +
theme_bw() +
theme(axis.title = element_text(size = 12),
axis.text = element_text(size = 10))
