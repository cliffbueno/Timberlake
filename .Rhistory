library(plyr) # Data manipulation
library(tidyverse) # Data manipulation
library(mctoolsr) # Microbial analyses
library(RColorBrewer) # Colors
library(vegan) # Multivariate analyses
library(indicspecies) # Indicator species
library(car) # Stats
library(FSA) # SE
library(magrittr) # Set names
library(PMCMRplus) # Stats
library(readxl) # Excel
library(writexl) # Excel
library(plotly) # Interactive plots
library(ggmap) # Maps
library(ggsn) # Maps
library(multcomp) # Tukey HSD and significance letters
library(emmeans) # Tukey HSD and significance letters
library(scales) # View colors
library(cowplot) # Multipanels
library(qvalue) # q values for indicator species
library(reshape2) # melt
library(gridExtra) # graphs
library(grid) # graphs
library(cowplot) # graphs
library(ggpubr) # graphs
library(ggExtra) # graphs
library(ggh4x) # graphs
library(dendextend) # graphs
library(corrplot) # correlation plots
library(pheatmap) # heatmaps
library(zCompositions) # CLR
library(compositions) # Aitchison
library(mobr) # rarefaction curves
library(plotly) # interactive graphs
library(pairwiseAdonis) # pairwise permanova
library(patchwork) # insets
# Functions
find_hull <- function(df) df[chull(df$Axis01, df$Axis02),]
`%notin%` <- Negate(`%in%`)
# Guild subsetting module from other repo
source("~/Documents/GitHub/SF_microbe_methane/modules/3_OTU_subsetting_modules_v.0.4_strip.r")
# Correlation functions from other repo
source("~/Documents/GitHub/EastCoast/code/meth_corr_by_taxonomy.R")
source("~/Documents/GitHub/EastCoast/code/meth_corr_by_bgc.R")
# Plotting functions from other repo
source("~/Documents/GitHub/EastCoast/code/cliffplot_taxa_bars.R")
source("~/Documents/GitHub/Extremophilic_Fungi/plot_multipatt.R")
# Effect size from Jack Darcy
source("~/Documents/GitHub/Timberlake/code/effectSize.R")
# Repository path
setwd("~/Documents/GitHub/Timberlake/")
# Wyatt Hartman's guild color palette
# Note that MeOB don't exist in this dataset, so removed
# But ANME do exist in this dataset, so add
# Extra methanogen guilds added so colors added too
Guild_cols <- read.table("~/Documents/GitHub/SF_microbe_methane/data/colors/Guild_color_palette.txt",
sep='\t') %>%
dplyr::select(Guild, G_index, color) %>%
set_names(c("Guild", "Index", "color")) %>%
mutate(Index = rev(Index)) %>%
add_row(Guild = "ANME", Index = 10, color = "#836FFF") %>%
add_row(Guild = "CH4_me", Index = 16, color = "#FDC086") %>%
add_row(Guild = "CH4_mix", Index = 17, color = "#FFFF99") %>%
filter(Guild != "MeOB") %>%
filter(Guild != "Anamx") %>%
arrange(Index)
nc <- readRDS("data/nc.rds")
# Add C, N, C:N data (was received later)
nc_cn <- read_excel("~/Documents/GitHub/EastCoast/data/Copy of CHN data.xls", sheet = 2) %>%
slice(12:91) %>%
dplyr::select(Name, `%N`, `%C`, `C:N`) %>%
mutate(Name = gsub("bottom", "bot", Name)) %>%
separate(Name, into = c("ID", "Depth"), sep = " ", remove = F) %>%
mutate(Treatment = substr(ID, start = 1, stop = 1),
Hydro = substr(ID, start = 2, stop = 2),
Replicate = substr(ID, start = 3, stop = 3)) %>%
filter(Hydro == "F") %>%
mutate(Treatment = recode_factor(Treatment,
"A" = "Control",
"B" = "ASW",
"C" = "ASW_noS",
"D" = "SO4")) %>%
mutate(Treatment = factor(Treatment,
levels = c("ASW", "ASW_noS", "Control", "SO4"))) %>%
arrange(desc(Depth), Treatment) %>%
filter(Name %notin% c("BF1 top", "BF2 top", "AF1 top", "DF2 top", "BF2 bot", "CF1 bot", "AF2 bot"))
rownames(nc$map_loaded)[11:43]
nc$map_loaded$sed_per_C[11:43] <- nc_cn$`%C`
nc$map_loaded$sed_per_N[11:43] <- nc_cn$`%N`
nc$map_loaded$sed_CN[11:43] <- nc_cn$`C:N`
# After looking at microbial alpha and beta diversity it is clear SO4 5B D1 and D2 are switched!
# Fix
for (i in 1:nrow(nc$map_loaded)) {
if (nc$map_loaded$sampleID[i] == "TL_inc_d1_SO4_5B") {
nc$map_loaded$Depth[i] <- "10-15 cm"
nc$map_loaded$sampleID_clean[i] <- "+SO4_5B_D2"
}
}
for (i in 1:nrow(nc$map_loaded)) {
if (nc$map_loaded$sampleID[i] == "TL_inc_d2_SO4_5B") {
nc$map_loaded$Depth[i] <- "0-5 cm"
nc$map_loaded$sampleID_clean[i] <- "+SO4_5B_D1"
}
}
# Add +SO4 core 5 data to 5A and 5B
new_dat <- read_excel("data/Soil pH-Jessie.xls", sheet = 3, na = "NA")
# rows 25, 26, 42, 43
# columns 10 - 24
nc$map_loaded[25, 10:24] <- new_dat[1, 2:16]
nc$map_loaded[26, 10:24] <- new_dat[2, 2:16]
nc$map_loaded[42, 10:24] <- new_dat[3, 2:16]
nc$map_loaded[43, 10:24] <- new_dat[4, 2:16]
# To recap, C, N, CN, pH have 5A D1 D2, 5B D1 D2. Porewater just has 5 D1 D2. GHG just 5
# Add two new columns for SO4 and ASW (following N + P type experiments)
# There's SO4, ASW, and both (just like N, P, NP)
nc$map_loaded$SO4 <- recode_factor(nc$map_loaded$Treatment,
"+SO4" = "Sulfate",
"+ASW" = "SaltSulfate")
nc$map_loaded$SO4 <- grepl(x = nc$map_loaded$SO4, pattern = "Sulfate")
nc$map_loaded$ASW <- recode_factor(nc$map_loaded$Treatment,
"+ASW-SO4" = "Salt",
"+ASW" = "SaltSulfate")
nc$map_loaded$ASW <- grepl(x = nc$map_loaded$ASW, pattern = "Salt")
#### _Methanogens ####
nc_mg <- filter_taxa_from_input(nc,
taxa_to_keep = c("CH4_ac", "CH4_H2", "CH4_me", "CH4_mix"),
at_spec_level = 9)
tax_sum_mg <- summarize_taxonomy(input = nc_mg,
level = 5,
report_higher_tax = T,
relative = F) %>%
mutate_all(funs((./82312)*100))
View(tax_sum_mg)
